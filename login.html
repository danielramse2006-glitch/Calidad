<script type="module">
    import { db } from './config.js';
    import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Asegurar que no hay sesiones basura al cargar el login
    sessionStorage.clear();

    document.getElementById('btnLogin').onclick = async () => {
        const u = document.getElementById('user').value.trim();
        const p = document.getElementById('pass').value.trim();

        if (u === "admin" && p === "#Reyn0sa#") {
            sessionStorage.setItem("currentUser", JSON.stringify({ usuario: 'admin' }));
            window.location.href = "index.html";
            return;
        }

        try {
            const q = query(collection(db, "usuarios"), where("usuario", "==", u), where("password", "==", p));
            const snap = await getDocs(q);
            if (!snap.empty) {
                sessionStorage.setItem("currentUser", JSON.stringify(snap.docs[0].data()));
                window.location.href = "index.html";
            } else {
                alert("Usuario o contraseña incorrectos");
            }
        } catch (e) {
            alert("Error de conexión con Firebase");
        }
    };
</script>